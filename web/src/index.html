<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        <title>YouTune</title>
        <link rel="shortcut icon"
              href="<%= require('./favicon.ico').default %>"
              type="image/x-icon"
        />

        <link rel="icon"
              href="<%= require('./favicon.ico').default %>"
              type="image/x-icon"
        />

        <link rel="stylesheet"
              href="<%= require('./style.css').default %>"
              type="text/css"
        />
        
        <script>
            var process = undefined;

            if (window.Notification)
                Notification.requestPermission();

            window.onerror = (message, source, lineno, colno, error) => {
                console.log(source);
                console.log(error);
                console.log(message);

                let app = document.getElementById("app");
                let header = document.createElement("h1");
                header.textContent = error;
                let text = document.createElement("div");
                text.textContent = message;
                app.appendChild(header);
                app.appendChild(text);
            }
            window.setImmediate = window.setTimeout;
            window.isUpdateAvailable = new Promise(function(resolve, reject) {
                // lazy way of disabling service workers while developing
                if ('serviceWorker' in navigator) {
                    // register service worker file
                    navigator.serviceWorker.register('/service-worker.js')
                        .then(reg => {
                            reg.onupdatefound = () => {
                                const installingWorker = reg.installing;
                                installingWorker.onstatechange = () => {
                                    switch (installingWorker.state) {
                                        case 'installed':
                                            if (navigator.serviceWorker.controller)
                                                // new update available
                                                return resolve(true);
                                                
                                            else
                                                // no update available
                                                return resolve(false);
                                    }
                                };
                            };
                        })

                        .catch(err => console.error('[SW ERROR]', err));
                } else {
                    resolve(false);
                }
            });
       </script>
    </head>
    <body>
        <div id="app"></div>
    </body>
</html>